if(!customElements.get('product-form')){customElements.define('product-form',class ProductForm extends HTMLElement{constructor(){super(),this.form=this.querySelector('form'),this.form.querySelector('[name=id]').disabled=!1,this.form.addEventListener('submit',this.onSubmitHandler.bind(this)),this.cart=document.querySelector('cart-notification')||document.querySelector('cart-drawer'),this.submitButton=this.querySelector('[type="submit"]'),document.querySelector('cart-drawer')&&this.submitButton.setAttribute('aria-haspopup','dialog')}onSubmitHandler(t){if(t.preventDefault(),this.submitButton.getAttribute('aria-disabled')==='true')return;this.handleErrorMessage(),this.submitButton.setAttribute('aria-disabled',!0),this.submitButton.classList.add('loading'),this.querySelector('.loading-overlay__spinner').classList.remove('hidden');const e=fetchConfig('javascript');e.headers['X-Requested-With']='XMLHttpRequest',delete e.headers['Content-Type'];const i=new FormData(this.form);if(this.cart){i.append('sections',this.cart.getSectionsToRender().map((t)=>t.id)),i.append('sections_url',window.location.pathname),this.cart.setActiveElement(document.activeElement)}e.body=i,fetch(`${routes.cart_add_url}`,e).then((t)=>t.json()).then((t)=>{if(t.status){this.handleErrorMessage(t.description);const e=this.submitButton.querySelector('.sold-out-message');if(!e)return;this.submitButton.setAttribute('aria-disabled',!0),this.submitButton.querySelector('span').classList.add('hidden'),e.classList.remove('hidden'),this.error=!0;return}else if(!this.cart){window.location=window.routes.cart_url;return}if(!this.error)publish(PUB_SUB_EVENTS.cartUpdate,{source:'product-form'});this.error=!1;const e=this.closest('quick-add-modal');if(e){document.body.addEventListener('modalClosed',()=>{setTimeout(()=>{this.cart.renderContents(t)})},{once:!0}),e.hide(!0)}else this.cart.renderContents(t)}).catch((t)=>{console.error(t)}).finally(()=>{this.submitButton.classList.remove('loading'),this.cart&&this.cart.classList.contains('is-empty')&&this.cart.classList.remove('is-empty'),!this.error&&this.submitButton.removeAttribute('aria-disabled'),this.querySelector('.loading-overlay__spinner').classList.add('hidden')})}handleErrorMessage(t=!1){this.errorMessageWrapper=this.errorMessageWrapper||this.querySelector('.product-form__error-message-wrapper');if(!this.errorMessageWrapper)return;this.errorMessage=this.errorMessage||this.errorMessageWrapper.querySelector('.product-form__error-message'),this.errorMessageWrapper.toggleAttribute('hidden',!t),t&&(this.errorMessage.textContent=t)}});}
